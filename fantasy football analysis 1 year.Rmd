#READ ME
Follow these two steps to get a "big board"
1. Initate your league rules
2. Run all the code
3. Order the table by PAR

If you're going to be using this live in your draft
1. Initiate league rules
2. Run all the code
3. Update who's been drafted so far in line 1612.  ExampleFormat= c("Saquon Barkley", "Christian McCaffrey", "etc...")
4. Update who you've drafted so far around line 1618.
5. Re-run code starting at line  You can run an entire block of code in mac with CMD+SHIFT+R
6. I recommend doing a few test picks before enterring the draft to make sure u know what u r doing





#initialize your league's rules
```{r}
numberOfTeams <- 10

isFlex <- FALSE

ppr <- 1
rushYards <- .1
receivingYards <- .1
rushTD <- 6
receivingTD <- 6
passYards <- .04
passTD <- 4
fmb <- -2
int <- -2
```


```{r}
library(tidyverse)
library(rvest)
library(stringr)
library(stringdist)
library(randomForest)
library(xgboost)
library(Matrix)
library(lubridate)
library(glmnet)
library(caret)
library(pls)
```

#Grabbing ESPN Projections
```{r}
getwd()
setwd("/Users/jacksoslow/Downloads")

espnProjections <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/projections/2019%20ESPN%20fantasy%20projections%20new.csv")
espnADP <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/adp/2019%20espn%20adp.csv")

nflELO <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/team%20elo%20data/nfl_elo.csv")

projections2010 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/projections/2010%20fantasy%20projections.csv")
#couldn't get 2011 projections
projections2012 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/projections/2012%20fantasy%20projections.csv")
projections2013 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/projections/2013%20fantasy%20projections.csv")
projections2014 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/projections/2014%20fantasy%20projections.csv")
projections2015 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/projections/2015%20fantasy%20projections.1.csv")
projections2016 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/projections/2016%20fantasy%20projections.csv")
projections2017 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/projections/2017%20projections%20new.csv")
projections2018 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/projections/2018%20projections%20new%20new.csv")

totalQBR2019 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/qbr%20data/Total%20QBR%20-%202019%20(1).csv")
totalQBR2018 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/qbr%20data/Total%20QBR%20-%202018.csv")
totalQBR2017 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/qbr%20data/Total%20QBR%20-%202017.csv")
totalQBR2016 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/qbr%20data/Total%20QBR%20-%202016%20(1).csv")
totalQBR2015 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/qbr%20data/Total%20QBR%20-%202015.csv")
totalQBR2014 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/qbr%20data/Total%20QBR%20-%202014.csv")
totalQBR2013 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/qbr%20data/Total%20QBR%20-%202013.csv")
totalQBR2012 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/qbr%20data/Total%20QBR%20-%202012.csv")
totalQBR2010 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/qbr%20data/Total%20QBR%20-%202010.csv")

depthChart2019 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/depth%20charts/2019%20espn%20depth%20charts.csv")
depthChart2018 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/depth%20charts/2018%20depth%20charts.1.csv")
depthChart2017 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/depth%20charts/2017%20depth%20charts.1.csv")
depthChart2016 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/depth%20charts/2016%20depth%20charts.csv")
depthChart2015 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/depth%20charts/2015%20depth%20charts.csv")
depthChart2014 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/depth%20charts/2014%20depth%20charts.csv")
depthChart2012 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/depth%20charts/2012%20depth%20charts.csv")
depthChart2010 <- read_csv("https://raw.githubusercontent.com/jsoslow2/Fantasy-Football-Models/master/data/depth%20charts/2010%20depth%20charts.1.csv")
```

#Scrape Player Stats since 2006
...takes around 3 minutes
```{r}
passing <- data.frame()
rushing <- data.frame()
receiving <- data.frame()
fantasyAll <- data.frame()

for (i in 2006:2018) {
  passingurl <- paste0("https://www.pro-football-reference.com/years/", i, "/passing.htm")
  rushingurl <- paste0("https://www.pro-football-reference.com/years/", i, "/rushing.htm")
  receivingurl <- paste0("https://www.pro-football-reference.com/years/", i, "/receiving.htm")
  fantasyurl <- paste0("https://www.pro-football-reference.com/years/", i, "/fantasy.htm")
  
  passingYear <- read_html(passingurl) %>% 
    html_nodes("table") %>% 
    html_table() 
  
  rushingYear <- read_html(rushingurl) %>% 
    html_nodes("table") %>% 
    html_table() 
  
  receivingYear <- read_html(receivingurl) %>% 
    html_nodes("table") %>% 
    html_table() 
  
  fantasyYear <- read_html(fantasyurl) %>% 
    html_nodes("table") %>% 
    html_table() 
  
  passingYear <- passingYear[[1]]
  passingYear$year <- i
  
  rushingYear <- rushingYear[[1]]
  rushingYear$year <- i
  
  receivingYear <- receivingYear[[1]]
  receivingYear$year <- i
  
  fantasyYear <- fantasyYear[[1]]
  fantasyYear$year <- i
  
  passing <- rbind(passing, passingYear)
  rushing <- rbind(rushing, rushingYear)
  receiving <- rbind(receiving, receivingYear)
  fantasyAll <- rbind(fantasyAll, fantasyYear)
}
```


#Clean ESPN  2019 Projections Table
```{r}
teams <- c()
names <- c()
positions <- c()

splittingStrings <- strsplit(espnProjections$Name, split = "\n")

for (i in 1:length(splittingStrings)) {
  name <- splittingStrings[[i]][1]
  teamPosition <- splittingStrings[[i]][2]
  team <- str_sub(teamPosition, 1, -3)
  position <- str_sub(teamPosition, -2, -1)
  
  
  names <- c(names, name)
  teams <- c(teams, team)
  positions <- c(positions, position)
}

espnProjections$Name <- names
espnProjections$Team <- teams
espnProjections$position <- positions

#clean injuries out of name
espnProjections$isQuestionable <- 0
espnProjections$isOut <- 0
espnProjections$isSuspended <- 0
espnProjections$isDoubtful <- 0 
espnProjections$injuredReserve <- 0

questionables <- grepl("^.+(Q)$",espnProjections$Name)
suspended <- grepl("^.+(SSPD)$",espnProjections$Name)
out <- grepl("^.+(O)$",espnProjections$Name)
doubtful <- grepl("^.+(D)$",espnProjections$Name)
injuredReserve <- grepl("^.+(IR)$",espnProjections$Name)


espnProjections[questionables,]$Name <- str_sub(espnProjections[questionables,]$Name, 1, -2)
espnProjections[questionables,]$isQuestionable <- 1

espnProjections[suspended,]$Name <- str_sub(espnProjections[suspended,]$Name, 1, -4)
espnProjections[suspended,]$isSuspended <- 1

espnProjections[out,]$Name <- str_sub(espnProjections[out,]$Name, 1, -2)
espnProjections[out,]$isOut <- 1

espnProjections[doubtful,]$Name <- str_sub(espnProjections[doubtful,]$Name, 1, -2)
espnProjections[doubtful,]$isDoubtful <- 1

espnProjections[injuredReserve,]$Name <- str_sub(espnProjections[injuredReserve,]$Name, 1, -3)
espnProjections[injuredReserve,]$injuredReserve <- 1
```

#Clean ESPN ADP Table
```{r}
teams <- c()
names <- c()
positions <- c()

splittingStrings <- strsplit(espnADP$Name, split = "\n")

for (i in 1:length(splittingStrings)) {
  name <- splittingStrings[[i]][1]
  teamPosition <- splittingStrings[[i]][2]
  team <- str_sub(teamPosition, 1, -3)
  position <- str_sub(teamPosition, -2, -1)
  
  
  names <- c(names, name)
  teams <- c(teams, team)
  positions <- c(positions, position)
}


espnADP$Name <- names
espnADP$Team <- teams
espnADP$position <- positions

espnADP[espnADP$position == "ST",]$Team <- str_sub(espnADP[espnADP$position == "ST",]$Team, 1, -3)


#Clean injuries out of name
espnADP$isQuestionable <- 0
espnADP$isOut <- 0
espnADP$isSuspended <- 0
espnADP$isDoubtful <- 0 

questionables <- grepl("^.+(Q)$",espnADP$Name)
suspended <- grepl("^.+(SSPD)$",espnADP$Name)
out <- grepl("^.+(O)$",espnADP$Name)
doubtful <- grepl("^.+(D)$",espnADP$Name)



espnADP[questionables,]$Name <- str_sub(espnADP[questionables,]$Name, 1, -2)
espnADP[questionables,]$isQuestionable <- 1

espnADP[suspended,]$Name <- str_sub(espnADP[suspended,]$Name, 1, -4)
espnADP[suspended,]$isSuspended <- 1

espnADP[out,]$Name <- str_sub(espnADP[out,]$Name, 1, -2)
espnADP[out,]$isOut <- 1

espnADP[doubtful,]$Name <- str_sub(espnADP[doubtful,]$Name, 1, -2)
espnADP[doubtful,]$isDoubtful <- 1
```




##MACHINE LEARNING PORTION BEEP BEEP!!##


#Clean o'clock


Clean ESPN 2015-2018 Projections
```{r}
#2010
projections2010$Name <- ""
projections2010$team <- ""

split_strings <- str_split(projections2010$rank, " ")
split_strings2 <- str_split(projections2010$`name,team`, " ")
split_string3 <- str_split(projections2010$`name,team`, ",")

i = 1
for (i in 1:length(split_strings)) {
  rank <- split_strings[[i]][2]
  rank <- str_sub(rank, 2,-2)
  
  items <- length(split_strings2[[i]])
  team <- split_strings2[[i]][items]
  name <- split_string3[[i]][1]
  
  projections2010$rank[i] <- rank
  projections2010$team[i] <- team
  projections2010$Name[i] <- name
  row <- projections2010[i,]
  projections2010$Name[i][row$position == "ST"] <- paste(team, "D/ST", sep = " ")
}
projections2010$team[projections2010$position == "ST"][1] <- "NYJ"
projections2010$team[projections2010$position == "ST"][2] <- "PHI"
projections2010$team[projections2010$position == "ST"][3] <- "GB"
projections2010$team[projections2010$position == "ST"][4] <- "BAL"
projections2010$team[projections2010$position == "ST"][5] <- "DAL"
projections2010$team[projections2010$position == "ST"][6] <- "SF"
projections2010$team[projections2010$position == "ST"][7] <- "MIN"
projections2010$team[projections2010$position == "ST"][8] <- "PIT"
projections2010$team[projections2010$position == "ST"][9] <- "CIN"
projections2010$team[projections2010$position == "ST"][10] <- "NO"
projections2010$team[projections2010$position == "ST"][11] <- "DEN"
projections2010$team[projections2010$position == "ST"][12] <- "NYG"
projections2010$team[projections2010$position == "ST"][13] <- "NE"
projections2010$team[projections2010$position == "ST"][14] <- "CLE"
projections2010$team[projections2010$position == "ST"][15] <- "HOU"

projections2010$year <- 2010
projections2010 <- projections2010 %>%  arrange(as.numeric(rank))


#2012
projections2012$Name <- ""
projections2012$team <- ""
projections2012$position <- ""
split_strings <- str_split(projections2012$`name, team`, ",")
split_strings2 <- str_split(projections2012$`rank, position`, " ")
i = 1 
for (i in 1:nrow(projections2012)) {
  name <- split_strings[[i]][1]
  team <- split_strings[[i]][2]
  team <- str_sub(team, 2, -1)
  
  posRank <- split_strings2[[i]][2]
  posRank <- str_sub(posRank, 2, -2)
  position <- str_extract(posRank, '\\D*(?=\\d)')
  position[position == "DEF"] <- "ST"
  
  projections2012$Name[i] <- name
  projections2012$team[i] <- team
  projections2012$position[i] <- position
}
projections2012$rank <- seq.int(nrow(projections2012))
projections2012$year <- 2012

#2013
projections2013$Name <- ""
projections2013$team <- ""
projections2013$position <- ""
split_strings <- str_split(projections2013$`name,team`, ",")
split_strings2 <- str_split(projections2013$`rank,position`, " ")
i = 1
for (i in 1:nrow(projections2013)) {
  name <- split_strings[[i]][1]
  team <- split_strings[[i]][2]
  team <- str_sub(team, 2, -1)
  
  posRank <- split_strings2[[i]][2]
  posRank <- str_sub(posRank, 2, -2)
  position <- str_extract(posRank, '\\D*(?=\\d)')
  position[position == "DEF"] <- "ST"
  
  projections2013$Name[i] <- name
  projections2013$team[i] <- team
  projections2013$position[i] <- position
}
projections2013$rank <- seq.int(nrow(projections2013))
projections2013$year <- 2013

#2014
projections2014$Name <- ""
projections2014$team <- ""
projections2014$position <- ""
split_strings <- str_split(projections2014$`Name, Team`, ",")
split_strings2 <- str_split(projections2014$Rank, " ")
i = 1
for (i in 1:nrow(projections2014)) {
  name <- split_strings[[i]][1]
  team <- split_strings[[i]][2]
  team <- str_sub(team, 2, -1)
  
  posRank <- split_strings2[[i]][2]
  posRank <- str_sub(posRank, 2, -2)
  position <- str_extract(posRank, '\\D*(?=\\d)')
  position[position == "DEF"] <- "ST"
  
  projections2014$Name[i] <- name
  projections2014$team[i] <- team
  projections2014$position[i] <- position
}
projections2014$rank <- seq.int(nrow(projections2014))
projections2014$year <- 2014

#2015
projections2015$Name <- ""
projections2015$team <- ""
projections2015$position <- ""
split_strings <- str_split(projections2015$`name team`, ",")
split_strings2 <- str_split(projections2015$`position rank`, " ")
i = 1
for (i in 1:nrow(projections2015)) {
  name <- split_strings[[i]][1]
  team <- split_strings[[i]][2]
  team <- str_sub(team, 2, -1)
  
  posRank <- split_strings2[[i]][2]
  posRank <- str_sub(posRank, 2, -2)
  position <- str_extract(posRank, '\\D*(?=\\d)')
  position[position == "DEF"] <- "ST"
  
  projections2015$Name[i] <- name
  projections2015$team[i] <- team
  projections2015$position[i] <- position
}
projections2015$rank <- seq.int(nrow(projections2015))
projections2015$year <- 2015


#2016
projections2016$Name <- gsub("^.*?\\.", "",projections2016$`RANK, PLAYER`)
projections2016 <- projections2016[2:5] %>% 
  select(Name, everything())
projections2016$rank <- seq.int(nrow(projections2016))
projections2016$year <- 2016

#2017
projections2017$Name <- ""
projections2017$team <- ""
projections2017$position <- ""
split_strings <- str_split(projections2017$NameTeam, ",")
split_strings2 <- str_split(projections2017$positionRank, " ")
i = 1 
for (i in 1:nrow(projections2017)) {
  name <- split_strings[[i]][1]
  team <- split_strings[[i]][2]
  team <- str_sub(team, 2, -1)
  
  posRank <- split_strings2[[i]][2]
  posRank <- str_sub(posRank, 2, -2)
  position <- str_extract(posRank, '\\D*(?=\\d)')
  position[position == "DEF"] <- "ST"
  
  projections2017$Name[i] <- name
  projections2017$team[i] <- team
  projections2017$position[i] <- position
}
projections2017$rank <- seq.int(nrow(projections2017))
projections2017$year <- 2017

#2018
projections2018$Name <- gsub("^.*?\\.", "",projections2018$Player)
projections2018 <- projections2018[2:5] %>% 
  select(Name, everything())
projections2018$rank <- seq.int(nrow(projections2018))
projections2018$year <- 2018
```


Combine all the projections tables
```{r}
##FORMAT 
##NAME TEAM POSITION YEAR RANK
projections2010 <- projections2010 %>% 
  select(Name, team, position, year, rank)

projections2012 <- projections2012 %>% 
  select(Name, team, position, year, rank)

projections2013 <- projections2013 %>% 
  select(Name, team, position, year, rank)

projections2014 <- projections2014 %>% 
  select(Name, team, position, year, rank)

projections2015 <- projections2015 %>% 
  select(Name, team, position, year, rank)

projections2016 <- projections2016 %>% 
  select(Name, 
         TEAM,
         POS,
         year,
         rank) %>% 
  rename(team = TEAM,
         position = POS)

projections2017 <- projections2017 %>% 
  select(Name, team, position, year, rank) 

projections2018 <- projections2018 %>% 
  select(Name, TEAM, POS, year, rank) %>% 
  rename(team = TEAM,
         position = POS)

allProjections <- rbind(projections2010, projections2012, projections2013, projections2014, projections2015, projections2016, projections2017, projections2018)
```

Clean QBR
```{r}
#2019
split <- str_split(totalQBR2019$PLAYER, ",")
totalQBR2019$team <- ""

i = 1
for (i in 1:length(split)) {
  name <- split[[i]][1]
  team <- split[[i]][2]
  team <- str_sub(team, 2,-1)
  
  totalQBR2019$PLAYER[i] <- name
  totalQBR2019$team[i] <- team
}
totalQBR2019$year <- 2019

#2018
split <- str_split(totalQBR2018$PLAYER, ",")
totalQBR2018$team <- ""

i = 1
for (i in 1:length(split)) {
  name <- split[[i]][1]
  team <- split[[i]][2]
  team <- str_sub(team, 2,-1)
  
  totalQBR2018$PLAYER[i] <- name
  totalQBR2018$team[i] <- team
}
totalQBR2018$year <- 2018

#2017
split <- str_split(totalQBR2017$PLAYER, ",")
totalQBR2017$team <- ""

i = 1
for (i in 1:length(split)) {
  name <- split[[i]][1]
  team <- split[[i]][2]
  team <- str_sub(team, 2,-1)
  
  totalQBR2017$PLAYER[i] <- name
  totalQBR2017$team[i] <- team
}
totalQBR2017$year <- 2017

#2016
split <- str_split(totalQBR2016$PLAYER, ",")
totalQBR2016$team <- ""

i = 1
for (i in 1:length(split)) {
  name <- split[[i]][1]
  team <- split[[i]][2]
  team <- str_sub(team, 2,-1)
  
  totalQBR2016$PLAYER[i] <- name
  totalQBR2016$team[i] <- team
}
totalQBR2016$year <- 2016

#2015
split <- str_split(totalQBR2015$PLAYER, ",")
totalQBR2015$team <- ""

i = 1
for (i in 1:length(split)) {
  name <- split[[i]][1]
  team <- split[[i]][2]
  team <- str_sub(team, 2,-1)
  
  totalQBR2015$PLAYER[i] <- name
  totalQBR2015$team[i] <- team
}
totalQBR2015$year <- 2015

#2014
split <- str_split(totalQBR2014$PLAYER, ",")
totalQBR2014$team <- ""

i = 1
for (i in 1:length(split)) {
  name <- split[[i]][1]
  team <- split[[i]][2]
  team <- str_sub(team, 2,-1)
  
  totalQBR2014$PLAYER[i] <- name
  totalQBR2014$team[i] <- team
}
totalQBR2014$year <- 2014

#2013
split <- str_split(totalQBR2013$PLAYER, ",")
totalQBR2013$team <- ""

i = 1
for (i in 1:length(split)) {
  name <- split[[i]][1]
  team <- split[[i]][2]
  team <- str_sub(team, 2,-1)
  
  totalQBR2013$PLAYER[i] <- name
  totalQBR2013$team[i] <- team
}
totalQBR2013$year <- 2013

#2012
split <- str_split(totalQBR2012$PLAYER, ",")
totalQBR2012$team <- ""

i = 1
for (i in 1:length(split)) {
  name <- split[[i]][1]
  team <- split[[i]][2]
  team <- str_sub(team, 2,-1)
  
  totalQBR2012$PLAYER[i] <- name
  totalQBR2012$team[i] <- team
}
totalQBR2012$year <- 2012

#2010
split <- str_split(totalQBR2010$PLAYER, ",")
totalQBR2010$team <- ""

i = 1
for (i in 1:length(split)) {
  name <- split[[i]][1]
  team <- split[[i]][2]
  team <- str_sub(team, 2,-1)
  
  totalQBR2010$PLAYER[i] <- name
  totalQBR2010$team[i] <- team
}
totalQBR2010$year <- 2010


allQBR <- rbind(totalQBR2010, totalQBR2012, totalQBR2013, totalQBR2014, totalQBR2015, totalQBR2016, totalQBR2017, totalQBR2018, totalQBR2019)
```

Clean depth charts
```{r}
#2019
depthChart2019$Name <- ""
splitty <- str_split(depthChart2019$`Name rank`, "[[(]]")
i <- 1
for (i in 1:length(splitty)) {
  name <- splitty[[i]][1]
  name <- str_sub(name, 1, -2)
  depthChart2019$Name[i] <- name
}
depthChart2019$year <- 2019

#2018
colnames(depthChart2018) <- c("depthChart", "nameRank", "team")
depthChart2018 <- depthChart2018[-1,]
depthChart2018$Name <- ""
splitty <- str_split(depthChart2018$nameRank, "[[(]]")
i <- 1
for (i in 1:length(splitty)) {
  name <- splitty[[i]][1]
  name <- str_sub(name, 1, -2)
  depthChart2018$Name[i] <- name
}
depthChart2018$year <- 2018

#2017
depthChart2017$Name <- ""
splitty <- str_split(depthChart2017$`Name position`, "[[(]]")
i <- 1
for (i in 1:length(splitty)) {
  name <- splitty[[i]][1]
  name <- str_sub(name, 1, -2)
  depthChart2017$Name[i] <- name
}
depthChart2017$year <- 2017

#2016
depthChart2016$Name <- ""
splitty <- str_split(depthChart2016$`Name position`, "[[(]]")
i <- 1
for (i in 1:length(splitty)) {
  name <- splitty[[i]][1]
  name <- str_sub(name, 1, -2)
  depthChart2016$Name[i] <- name
}
depthChart2016$year <- 2016

#2015
depthChart2015$Name <- ""
splitty <- str_split(depthChart2015$`Name position`, "[[(]]")
i <- 1
for (i in 1:length(splitty)) {
  name <- splitty[[i]][1]
  name <- str_sub(name, 1, -2)
  depthChart2015$Name[i] <- name
}
depthChart2015$year <- 2015
depthChart2015$Name[depthChart2015$Name == "Steve Smith"] <- "Steve Smith Sr."

#2014
depthChart2014$Name <- ""
splitty <- str_split(depthChart2014$`Name Position`, "[[(]]")
i <- 1
for (i in 1:length(splitty)) {
  name <- splitty[[i]][1]
  name <- str_sub(name, 1, -2)
  depthChart2014$Name[i] <- name
}
depthChart2014$year <- 2014

#2012
depthChart2012$Name[endsWith(depthChart2012$Name, "(R)")] <- str_sub(depthChart2012$Name[endsWith(depthChart2012$Name, "(R)")], 1, -5)
splitty <- str_split(depthChart2012$Name, "[[+]]")
i = 1
for (i in 1:length(splitty)) {
  Name <- splitty[[i]][1]
  depthChart2012$Name[i] <- Name
}
depthChart2012$year <- 2012

#2010
depthChart2010$Name[endsWith(depthChart2010$Name, "(R)")] <- str_sub(depthChart2010$Name[endsWith(depthChart2010$Name, "(R)")], 1, -5)
depthChart2010$Name[endsWith(depthChart2010$Name, "*")] <- str_sub(depthChart2010$Name[endsWith(depthChart2010$Name, "*")], 1, -2)
depthChart2010$Name[endsWith(depthChart2010$Name, " ")] <- str_sub(depthChart2010$Name[endsWith(depthChart2010$Name, " ")], 1, -2)
splitty <- str_split(depthChart2010$Name, "[[+]]")
i = 1
for (i in 1:length(splitty)) {
  Name <- splitty[[i]][1]
  depthChart2010$Name[i] <- Name
}
depthChart2010$year <- 2010


#Combine all
depthChart2019 <- depthChart2019 %>% select(Name, year, depthChart)
depthChart2018 <- depthChart2018 %>% select(Name, year, depthChart)
depthChart2017 <- depthChart2017 %>% rename(depthChart = depthCharts) %>% select(Name, year, depthChart)
depthChart2016<- depthChart2016 %>% rename(depthChart = `depth charts`) %>% select(Name, year, depthChart)
depthChart2015 <- depthChart2015 %>% rename(depthChart = depthCharts) %>%  select(Name, year, depthChart)
depthChart2014 <- depthChart2014 %>% rename(depthChart = depthCharts) %>%  select(Name, year, depthChart)
depthChart2012 <- depthChart2012 %>% rename(depthChart = depthCharts) %>%  select(Name, year, depthChart)
depthChart2010 <- depthChart2010 %>% rename(depthChart = depthCharts) %>%  select(Name, year, depthChart)

depthChartsAll <- rbind(depthChart2019, depthChart2018, depthChart2017, depthChart2016, depthChart2015, depthChart2014, depthChart2012, depthChart2010)
```


Clean the fantasy table
```{r}
#Clean fantasy table
fantasy <- fantasyAll

colnames(fantasy) <- as.character(unlist(fantasy[1,]))
fantasy <- fantasy[-1,]
colnames(fantasy)[9] <- "passAtt"
colnames(fantasy)[10] <- "passYds"
colnames(fantasy)[11] <- "passTDs"
colnames(fantasy)[13] <- "rushAtt"
colnames(fantasy)[14] <- "rushYds"
colnames(fantasy)[16] <- "rushTDs"
colnames(fantasy)[19] <- "recYds"
colnames(fantasy)[21] <- "recTDs"
colnames(fantasy)[24] <- "totalTDs"
colnames(fantasy)[34] <- "year"
fantasy$year <- fantasy$year + 1

endWithPlus <- grepl("^.+(\\+)$",fantasy$Player)
fantasy$Player[endWithPlus] <- str_sub(fantasy$Player[endWithPlus], 1, -2)
endWithStar <- grepl("^.+(\\*)$",fantasy$Player)
fantasy$Player[endWithStar] <- str_sub(fantasy$Player[endWithStar], 1, -2)

colnames(fantasy)

fantasy <- fantasy %>% filter(FantPos != "FantPos")
```


#Start here if changing league dimensions
Join projections w QBR
```{r}
#some team names r diff
allQBR[allQBR$team == "JAX",]

allQBR$team[allQBR$team == "JAX"] <- "JAC"
allQBR$team[allQBR$team == "WSH"] <- "WAS"
allQBR$team[allQBR$team == "LAC" & allQBR$year < 2017] <- "SD"
allQBR$team[allQBR$team == "LAR" & allQBR$year < 2016] <- "STL"

allQBR$team

#Average years where multiple qbs played
summarisedQBR <- allQBR %>% 
  group_by(year, team) %>% 
  summarise(avgQBR = mean(`TOTAL QBR`),
            avgPass = mean(PASS),
            avgRun = mean(RUN),
            passPlay = mean(`QB PLAYS`))

pastProjections <- allProjections

pastProjections <- pastProjections %>% left_join(summarisedQBR, by = c("team" = "team",
                                                    "year" = "year"))



quantile(pastProjections$avgPass, na.rm = TRUE)[2]


pastProjections$avgPass[is.na(pastProjections$avgPass)] <- quantile(pastProjections$avgPass, na.rm = TRUE)[2]
pastProjections$avgRun[is.na(pastProjections$avgRun)] <- quantile(pastProjections$avgRun, na.rm = TRUE)[2]
pastProjections$avgQBR[is.na(pastProjections$avgQBR)] <- quantile(pastProjections$avgQBR, na.rm = TRUE)[2]
pastProjections$passPlay[is.na(pastProjections$passPlay)] <- quantile(pastProjections$passPlay, na.rm = TRUE)[2]
```

Join projections with depth charts
```{r}
pastProjections$Name[startsWith(pastProjections$Name, " ")] <- str_sub(pastProjections$Name[startsWith(pastProjections$Name, " ")], 2, -1)
pastProjections <- pastProjections %>% left_join(depthChartsAll, by = c("Name", 
                                                     "year"))


pastProjections$position[pastProjections$position == "DST"] <- "ST"

pastProjections <- pastProjections[!duplicated(pastProjections %>% select(Name, team, depthChart,year)),]
pastProjections$depthChart[pastProjections$year == 2013] <- "not available"
pastProjections$depthChart[pastProjections$position == "ST"] <- "ST"
pastProjections$depthChart[pastProjections$position == "K"] <- "K"
pastProjections$depthChart[pastProjections$Name == " Le'Veon Bell"] <- "RB1"
pastProjections$depthChart[is.na(pastProjections$depthChart)] <- "FA"

```


Join the tables and fix names (KILL ME)
```{r}
#Make the names the same

#find the closest matching string to a vector
closestMatch = function(string, stringVector){
  stringVector[amatch(string, stringVector, maxDist=Inf)]
}

#get rid of first space names
pastProjections$Name[startsWith(pastProjections$Name, " ")] <- str_sub(pastProjections$Name[startsWith(pastProjections$Name, " ")], 2, -1)


#Some Special Teams names r real bad
specialTeams <- pastProjections %>% filter(position == "ST")
badBoys <- specialTeams[!(endsWith(specialTeams$Name, "D/ST")),]

splitString <- str_split(badBoys$Name, " ")
i = 1
for (i in 1:length(splitString)) {
  event <- splitString[[i]]
  theLength <- length(event)
  teamName <- event[theLength]
  theName <- paste(teamName, "D/ST", sep = " ")
  badBoys$Name[i] <- theName
}

pastProjections <- pastProjections %>% 
  mutate(Name = replace(Name, position == "ST" & !(endsWith(Name, "D/ST")), badBoys$Name))

#find most similar name to fantasy names
pastProjections$closestName <- ""
i = 1
for (i in 1:nrow(pastProjections)) {
  row <- pastProjections[i,]
  theYear <- row$year
  
  fantasyFiltered <- fantasy %>% filter(year %in% c(theYear, theYear-1))
  row <- row %>% 
    mutate(closestName = closestMatch(Name, fantasyFiltered$Player))
  pastProjections$closestName[i] <- row$closestName
}

#backwards Match o'clock
for (i in 1:nrow(fantasy)) {
  row <- fantasy[i,]
  theYear <- row$year
  
  projectionsFiltered <- pastProjections %>% filter(year %in% c(theYear, theYear+1))
  row <- row %>% 
    mutate(closestName = closestMatch(Player, projectionsFiltered$Name))
  fantasy$closestName[i] <- row$closestName
}

combined <- pastProjections %>% left_join(fantasy, by = c("closestName" = "Player",
                                                          "Name" = "closestName",
                                                  "year" = "year"))


#filtering out all you generic named FUCKS
davidJohnsonFilter <- !(combined$Name == "David Johnson" & (combined$Age > 26 | combined$Tm %in% c("SDG", "PIT")))
chrisThompsonFilter <- !(combined$Name == "Chris Thompson" & combined$FantPos == "WR")
adrianPetersonFilter <- !(combined$Name == "Adrian Peterson" & combined$Tm == "CHI")
alexSmithFilter <- !(combined$Name == "Alex Smith" & (combined$FantPos != "QB" | combined$Tm %in% c("WAS", "CLE", "TAM")))
chrisGivensFilter <- !(combined$Name == "Chris Givens")
mikeWilliamsFilter <- !(combined$Name == "Mike Williams" & combined$team == "SEA")
mikeWilliamsFilter2 <- !(combined$Name == "Mike Williams" & combined$Tm == "SEA")
mikeWilliamsFilter3 <- !(combined$Name == "Mike Williams" & combined$Tm == "SEA")
zachMillerFilter <- !(combined$Name == "Zach Miller" & combined$Tm == "JAX")
zachMillerFilter2 <- !(combined$Name == "Zach Miller" & combined$Tm == "JAX")
#fuck steve smith i dont have time for this
steveSmithFilter <- !(combined$Name == "Steve Smith")

#filter
combined.1 <- combined %>% 
  filter(davidJohnsonFilter & chrisThompsonFilter & adrianPetersonFilter & alexSmithFilter & chrisGivensFilter & mikeWilliamsFilter & mikeWilliamsFilter2 & mikeWilliamsFilter3 & zachMillerFilter & zachMillerFilter2 & steveSmithFilter)

# #add two years back data
# fantasyCopy <- fantasy
# fantasyCopy$year <- fantasy$year+1
# 
# unique(fantasy$year)
# 
# 
# 
# 
# combinedCopy <- combined %>% left_join(fantasyCopy, by = c("closestName" = "Player",
#                                                            "Name" = "closestName",
#                                            "year" = "year"))


# 
# #Some Players have the same stupid generic name...
# combined %>% 
#   group_by(Name) %>% 
#   mutate(unique_years = n_distinct(year)) %>% 
#   ungroup() %>% 
#   group_by(Name, unique_years) %>% 
#   summarise(rows = dplyr::n()) %>% 
#   mutate(difference = rows - unique_years) %>% 
#   filter(difference != 0)
# 
# combinedCopy %>% filter(Name == "David Johnson")
# combinedCopy %>% filter(Name == "Chris Thompson")
# combinedCopy %>% filter(Name == "Adrian Peterson")
# combinedCopy %>% filter(Name == "Alex Smith")
# combinedCopy %>% filter(Name == "Chris Givens")
# combinedCopy %>% filter(Name == "Mike Williams")
# combinedCopy %>% filter(Name == "Zach Miller")
# combinedCopy %>% filter(Name == "Steve Smith")
# 
# 
# 
# #filtering out all you generic named FUCKS
# davidJohnsonFilter <- !(combinedCopy$Name == "David Johnson" & (combinedCopy$Age.x > 26 | combinedCopy$Tm.y %in% c("SDG", "PIT")))
# chrisThompsonFilter <- !(combinedCopy$Name == "Chris Thompson" & combinedCopy$FantPos.x == "WR")
# adrianPetersonFilter <- !(combinedCopy$Name == "Adrian Peterson" & combinedCopy$Tm.x == "CHI")
# alexSmithFilter <- !(combinedCopy$Name == "Alex Smith" & (combinedCopy$FantPos.x != "QB" | combinedCopy$Tm.y %in% c("WAS", "CLE", "TAM")))
# chrisGivensFilter <- !(combinedCopy$Name == "Chris Givens")
# mikeWilliamsFilter <- !(combinedCopy$Name == "Mike Williams" & combinedCopy$team == "SEA")
# mikeWilliamsFilter2 <- !(combinedCopy$Name == "Mike Williams" & combinedCopy$Tm.x == "SEA")
# mikeWilliamsFilter3 <- !(combinedCopy$Name == "Mike Williams" & combinedCopy$Tm.y == "SEA")
# zachMillerFilter <- !(combinedCopy$Name == "Zach Miller" & combinedCopy$Tm.x == "JAX")
# zachMillerFilter2 <- !(combinedCopy$Name == "Zach Miller" & combinedCopy$Tm.y == "JAX")
# #fuck steve smith i dont have time for this
# steveSmithFilter <- !(combinedCopy$Name == "Steve Smith")
# 
# 
# 
# 
# #filter
# combined.1 <- combinedCopy %>% 
#   filter(davidJohnsonFilter & chrisThompsonFilter & adrianPetersonFilter & alexSmithFilter & chrisGivensFilter & mikeWilliamsFilter & mikeWilliamsFilter2 & mikeWilliamsFilter3 & zachMillerFilter & zachMillerFilter2 & steveSmithFilter)

combined <- combined.1[!(duplicated(combined.1)),]

combined %>% filter(Name == "David Johnson")
combined %>% filter(Name == "Chris Thompson")
combined %>% filter(Name == "Adrian Peterson")
combined %>% filter(Name == "Alex Smith")
combined %>% filter(Name == "Chris Givens")
combined %>% filter(Name == "Mike Williams")
combined %>% filter(Name == "Zach Miller")
combined %>% filter(Name == "Steve Smith")

combined <- combined %>% 
  select(-c(Tm, FantPos))
```

Get the response variable (Next years points)
#takes around 3 minutes
```{r}
#Get the ensuing year's points
combined$actualPoints = 0
x <- 0

which(combined$Name == "Odell Beckham Jr.")

combined %>% filter(Name == "Odell Beckham")
i = 1272
for (i in 1:nrow(combined)) {
  row <- combined[i,]
  nextYear <- row$year + 1
  name <- row$Name
  rowClosestName <- row$closestName
  position <- row$position
  team <- row$team
  
  
  
  
  nextYearsRow <- fantasy %>% filter(Player == name,
                                     year == nextYear,
                                     FantPos == position)
  
  nextYearsRow2 <- fantasy %>% filter(Player == rowClosestName,
                                     year == nextYear,
                                     FantPos == position)
  
  x[nrow(nextYearsRow) > 1] <- ifelse(any(nextYearsRow$Tm ==team), which(nextYearsRow$Tm == team), 1)
  newVar <- nextYearsRow[x,]
  
  newVar[,6:ncol(newVar)] <- sapply(newVar[6:ncol(newVar)], as.numeric)
  nextYearsRow[,6:ncol(nextYearsRow)] <- sapply(nextYearsRow[6:ncol(nextYearsRow)], as.numeric)
  nextYearsRow2[,6:ncol(nextYearsRow2)] <- sapply(nextYearsRow2[6:ncol(nextYearsRow2)], as.numeric)

  
  newVar <- newVar %>% 
    mutate(points = Rec*ppr + recYds*receivingYards + recTDs*receivingTD + rushYards*rushYds + rushTD*rushTDs + passYards*passYds + passTDs*passTD + int*Int + fmb*Fmb)
  nextYearsRow <- nextYearsRow %>% 
    mutate(points = Rec*ppr + recYds*receivingYards + recTDs*receivingTD + rushYards*rushYds + rushTD*rushTDs + passYards*passYds + passTDs*passTD + int*Int + fmb*Fmb)
  nextYearsRow2 <- nextYearsRow2 %>% 
    mutate(points = Rec*ppr + recYds*receivingYards + recTDs*receivingTD + rushYards*rushYds + rushTD*rushTDs + passYards*passYds + passTDs*passTD + int*Int + fmb*Fmb)
  
  actualPoints <- ifelse(nrow(nextYearsRow) > 1, newVar$points, ifelse(nrow(nextYearsRow) == 0, nextYearsRow2$points, nextYearsRow$points))
  actualPoints[is_empty(actualPoints)] <- 0
  actualPoints[is.na(actualPoints)] <- 0
  
  combined[i,]$actualPoints <- actualPoints
}

combined$actualPoints
```

join team ELO from last season
```{r}
combined$elo1_post.x
#Elo Cleaning
eloSince2006 <- nflELO[nflELO$season >=2006,]
eloSince2006$team1[eloSince2006$team1 == "JAX"] <- "JAC"
eloSince2006$team1[eloSince2006$team1 == "WSH"] <- "WAS"
eloSince2006$team1[eloSince2006$team1 == "LAC" & year(eloSince2006$date) < 2017] <- "SD"
eloSince2006$team1[eloSince2006$team1 == "LAR" & year(eloSince2006$date) < 2016] <- "STL"

finalSeasonElo <- eloSince2006 %>% group_by(season, team1) %>% top_n(1, date) %>% 
  select(team1, season, elo1_post)
finalSeasonElo$season <- finalSeasonElo$season + 1

table(finalSeasonElo$team1)


#joining

combined <- combined %>% left_join(finalSeasonElo, by = c("team" ="team1",
                                                          "year" = "season"))

combined$elo1_post[is.na(combined$elo1_post)] <- 1500
```



Data Prep for ML and Feature Engineering
```{r}
modelData <- combined

modelData$Rk <- as.numeric(modelData$Rk)
modelData$rank <- as.numeric(modelData$rank)
modelData <- modelData %>% select(Name, position, depthChart, everything())

modelData[,6:ncol(modelData)] <- sapply(modelData[6:ncol(modelData)], as.numeric)

modelData <- modelData %>% 
  rename(yardsPerAttempt = `Y/A`,
         yardsPerReception = `Y/R`,
         twoPM = `2PM`,
         twoPP = `2PP`) %>% 
  select(actualPoints, everything())

modelData$isRookie <- ifelse(is.na(modelData$Rk), 1, 0)

modelData <- modelData %>% 
  mutate(passRate = passAtt / GS,
         rushAttRate = rushAtt / GS,
         rushYdsRate = rushYds / GS,
         tgtRate = Tgt / GS,
         recRate = Rec / GS,
         recYdsRate = recYds / GS,
         DKPtRate = DKPt / GS, 
         yearsFromPresent = (2019 - year)
  )

is.na(modelData)<-sapply(modelData, is.infinite)
modelData[is.na(modelData)] <- 0

#fix 
modelData$team[modelData$team == "JAC"] <- "JAX"
modelData$team[modelData$team == "WAS"] <- "WSH"

modelData$position[modelData$position == "DST"] <- "ST"

modelData <- modelData %>% mutate_if(is.character, as.factor)
```


Train/Test Split
```{r}
#FOR NOW EXCLUDE ST and K!!!
x <- modelData %>% select(-c(Name, year, team, closestName)) %>%  filter(!position %in% c("ST", "K"))
indexes = sample(1:nrow(x), size=0.2*nrow(x))

# Split data
test = x[indexes,]
train = x[-indexes,]
```


```{r}
logit <- lm(actualPoints ~ ., data = train)
anova(logit)
```

```{r}
predictionsLogit <- predict(logit, test, type="response")
plot(predictionsLogit, test$actualPoints)
cor(predictionsLogit, test$actualPoints)
```


Random
```{r}
rf <- randomForest(actualPoints ~ ., data = train, na.action = na.exclude)
rf
varImpPlot(rf)
```

```{r}
predictionsRF <- predict(rf, test, type="response")
plot(predictionsRF, test$actualPoints)
cor(predictionsRF, test$actualPoints)
```



<!-- XGBoost szn -->
<!-- ```{r} -->
<!-- sparse_matrix <- sparse.model.matrix(actualPoints~.-1, data = train) -->
<!-- output_vector = train$actualPoints -->
<!-- sparse_matrix_test <- sparse.model.matrix(actualPoints~.-1, data = test) -->
<!-- output_vector_test <- test$actualPoints -->
<!-- ``` -->

<!-- ```{r, results='hide'} -->
<!-- bst <- xgboost( data = sparse_matrix, label = output_vector, max_depth = 7, eta = .01, nthread = 2, nrounds = 1200,gamma = 0, min_child_weight = 1, subsample= .7, colsample_bytree=.7, objective = "reg:linear") -->
<!-- ``` -->


<!-- ```{r} -->
<!-- predictionsXG <- predict(bst, sparse_matrix_test, type="response") -->
<!-- plot(predictionsXG, test$actualPoints) -->
<!-- cor(predictionsXG, test$actualPoints) -->
<!-- ``` -->

Try ridge regression
```{r}
y <- train$actualPoints
x <- train %>% select(-c(actualPoints)) %>% select(everything()) %>% data.matrix()
lambdas <- 10^seq(3, -2, by = -.1)

cv_fit <- cv.glmnet(x, y, alpha = 0, lambda = lambdas)
plot(cv_fit)
opt_lambda <- cv_fit$lambda.min
fit <- cv_fit$glmnet.fit
```

```{r}
yTest <- test$actualPoints
xTest <- test %>% select(-c(actualPoints)) %>% select(everything()) %>% data.matrix()
y_predicted <- predict(fit, s = opt_lambda, newx = xTest)
sst <- sum((yTest - mean(yTest))^2)
sse <- sum((y_predicted - yTest)^2)

plot(y_predicted, test$actualPoints)

# R squared
rsq <- 1 - sse / sst
rsq^.5
```


Try Partial Least Squares
```{r}
#turn position into a metric
trainPLS <-train %>% 
  group_by(position, yearsFromPresent) %>% 
  summarise(avgPositionPTs = mean(DKPt)) %>% 
  ungroup() %>% 
  right_join(train) %>% 
  mutate(position = avgPositionPTs) %>% 
  select(-avgPositionPTs)

trainPLS <- train %>% 
  group_by(depthChart, yearsFromPresent) %>% 
  summarise(avgDepthChartPTs = mean(DKPt)) %>% 
  ungroup() %>% 
  right_join(trainPLS) %>% 
  mutate(depthChart = avgDepthChartPTs) %>% 
  select(-avgDepthChartPTs)

testPLS <- test %>% 
  group_by(position, yearsFromPresent) %>% 
  summarise(avgPositionPTs = mean(DKPt)) %>% 
  ungroup() %>% 
  right_join(test) %>% 
  mutate(position = avgPositionPTs) %>% 
  select(-avgPositionPTs)

testPLS <- test %>% 
  group_by(depthChart, yearsFromPresent) %>% 
  summarise(avgDepthChartPTs = mean(DKPt)) %>% 
  ungroup() %>% 
  right_join(testPLS) %>% 
  mutate(depthChart = avgDepthChartPTs) %>% 
  select(-avgDepthChartPTs)


set.seed(123)
model <- train(
  actualPoints~., data = trainPLS, method = "pls",
  scale = TRUE,
  trControl = trainControl("cv", number = 10),
  tuneLength = 10
  )

plot(model)
model$bestTune
summary(model$finalModel)

predictions <- model %>% predict(testPLS)
data.frame(
  RMSE = caret::RMSE(predictions, test$actualPoints),
  Rsquare = caret::R2(predictions, test$actualPoints)
)
```




Prep this year's projections for the model muahaha
```{r}
recentFantasy <- fantasy %>% filter(year == 2019)
newName <- ""
backwardsMatch <- ""
for (i in recentFantasy$Player) {
  newName <- c(newName, closestMatch(i, espnProjections$Name))
}
for (i in espnProjections$Name) {
  backwardsMatch <- c(backwardsMatch, closestMatch(i, recentFantasy$Player))
}
newName <- newName[-1]
backwardsMatch <- backwardsMatch[-1]


espnProjections$backwardsMatch <- backwardsMatch
recentFantasy$newName <- newName

#wrong matches
espnProjections$backwardsMatch[espnProjections$Name %in% c("Le'Veon Bell", "Josh Jacobs")] <- "" 

x <- espnProjections %>% select(Rank, Name, Team, position, backwardsMatch) %>% 
  mutate(yearsFromPresent = 0,
         year = 2019) %>% left_join(recentFantasy, by = c("backwardsMatch" = "Player",
                                                    "Name" = "newName")) 





# twoYearsAgo <- fantasy %>% filter(year == 2018)
# newName <- ""
# backwardsMatch <- ""
# for (i in twoYearsAgo$Player) {
#   newName <- c(newName, closestMatch(i, x$Name))
# }
# for (i in x$Name) {
#   backwardsMatch <- c(backwardsMatch, closestMatch(i, twoYearsAgo$Player))
# }
# 
# newName <- newName[-1]
# backwardsMatch <- backwardsMatch[-1]
# 
# x$backwardsMatch <- backwardsMatch
# twoYearsAgo$newName <- newName
# 
# twoYearsAgo$year <- 2019
# 
# x <- x %>% left_join(twoYearsAgo, by = c("backwardsMatch" = "Player",
#                                     "Name" = "newName"))


x <- x[!duplicated(x),]
```

Feature Eng of this years projections
```{r}
thisYearsProjections <- x %>% filter(position %in% c("WR", "RB", "TE", "QB"), 
                                     Name != "Mark Walton")

#Team Clean
thisYearsProjections$Team <- str_to_upper(thisYearsProjections$Team)

#Add Elo
finalSeasonElo$team1[finalSeasonElo$season == 2019 & finalSeasonElo$team1 == "JAC"] <- "JAX" 
finalSeasonElo$team1[finalSeasonElo$season == 2019 & finalSeasonElo$team1 == "WAS"] <- "WSH" 
thisYearsProjections <- thisYearsProjections %>% left_join(finalSeasonElo, by = c("Team" = "team1",
                                                                                  "year.x" = "season"))

#add QBR
summarisedQBR <- summarisedQBR %>% filter(year == 2019)
summarisedQBR$team[summarisedQBR$team == "JAC"] <- "JAX" 
summarisedQBR$team[summarisedQBR$team == "WAS"] <- "WSH" 
thisYearsProjections <- thisYearsProjections %>% left_join(summarisedQBR, by = c("Team" = "team"))

#add depth charts
thisYearsProjections <- thisYearsProjections %>% left_join(depthChart2019, by = c("Name"))
thisYearsProjections$depthChart[is.na(thisYearsProjections$depthChart)] <- "FA"



thisYearsProjections$Rk <- as.numeric(thisYearsProjections$Rk)
thisYearsProjections$rank <- as.numeric(thisYearsProjections$Rank)


thisYearsProjections$year
thisYearsProjections <- thisYearsProjections %>% 
  select(-c(backwardsMatch, year.y, year.y.y, year.x, year.x.x, FantPos, Tm, Team, closestName))

thisYearsProjections <- thisYearsProjections %>% select(Name, position, depthChart, everything())


thisYearsProjections[,4:ncol(thisYearsProjections)] <- sapply(thisYearsProjections[4:ncol(thisYearsProjections)], as.numeric)

#rename columns
thisYearsProjections <- thisYearsProjections %>% 
  rename(yardsPerAttempt = `Y/A`,
         yardsPerReception = `Y/R`,
         twoPM = `2PM`,
         twoPP = `2PP`,) 

thisYearsProjections$isRookie <- ifelse(is.na(thisYearsProjections$Rk), 1, 0)


thisYearsProjections <- thisYearsProjections %>% 
  mutate(passRate = passAtt / GS,
         rushAttRate = rushAtt / GS,
         rushYdsRate = rushYds / GS,
         tgtRate = Tgt / GS,
         recRate = Rec / GS,
         recYdsRate = recYds / GS,
         DKPtRate = DKPt / GS
  )


is.na(thisYearsProjections)<-sapply(thisYearsProjections, is.infinite)
thisYearsProjections[is.na(thisYearsProjections)] <- 0

thisYearsProjections <- thisYearsProjections %>% mutate_if(is.character, as.factor)

thisYearsProjections %>% select(Name, PPR)
```

final clean it up yeet
```{r}
colnames(train)

predictionData <- data.frame(
  position = thisYearsProjections$position,
  rank = thisYearsProjections$Rank,
  
  depthChart = thisYearsProjections$depthChart,
  
  avgQBR = thisYearsProjections$avgQBR,
  avgPass = thisYearsProjections$avgPass,
  avgRun = thisYearsProjections$avgRun,
  passPlay = thisYearsProjections$passPlay,
  
  Rk = thisYearsProjections$Rk,
  Age = thisYearsProjections$Age,
  G = thisYearsProjections$G,
  GS = thisYearsProjections$GS,
  Cmp = thisYearsProjections$Cmp,
  passAtt = thisYearsProjections$passAtt,
  passYds = thisYearsProjections$passYds,
  passTDs = thisYearsProjections$passTDs,
  Int = thisYearsProjections$Int,
  rushAtt = thisYearsProjections$rushAtt,
  rushYds = thisYearsProjections$rushYds,
  yardsPerAttempt = thisYearsProjections$yardsPerAttempt,
  rushTDs = thisYearsProjections$rushTDs,
  Tgt = thisYearsProjections$Tgt,
  Rec = thisYearsProjections$Rec,
  recYds = thisYearsProjections$recYds,
  yardsPerReception = thisYearsProjections$yardsPerReception,
  recTDs = thisYearsProjections$recTDs,
  Fmb = thisYearsProjections$Fmb,
  FL = thisYearsProjections$FL,
  totalTDs = thisYearsProjections$totalTDs,
  twoPM = thisYearsProjections$twoPM,
  twoPP = thisYearsProjections$twoPP,
  FantPt = thisYearsProjections$FantPt,
  PPR = thisYearsProjections$PPR,
  DKPt = thisYearsProjections$DKPt,
  FDPt = thisYearsProjections$FDPt,
  VBD = thisYearsProjections$VBD, 
  PosRank = thisYearsProjections$PosRank,
  OvRank = thisYearsProjections$OvRank,
  
  elo1_post = thisYearsProjections$elo1_post,
  isRookie = thisYearsProjections$isRookie,
  passRate = thisYearsProjections$passRate,
  rushAttRate = thisYearsProjections$rushAttRate,
  rushYdsRate = thisYearsProjections$rushYdsRate,
  tgtRate = thisYearsProjections$tgtRate,
  recRate = thisYearsProjections$recRate,
  recYdsRate = thisYearsProjections$recYdsRate,
  DKPtRate = thisYearsProjections$DKPtRate,
  yearsFromPresent = thisYearsProjections$yearsFromPresent
)
```


Prepare for liftoff
```{r}
x <- modelData %>% select(-c(Name, year, team, closestName)) %>%  filter(!position %in% c("ST", "K"))

platter <- rbind(predictionData, x[,-1])
predictionData <- platter[1:nrow(predictionData),]
trainRF <- platter[-(1:nrow(predictionData)),]

platter <- platter %>% mutate_if(is.character, as.factor)

trainRF$actualPoints <- x$actualPoints

for (f in 1:length(names(platter))) {
  levels(trainRF[, f]) <- levels(platter[, f])
}

thisYearsProjectionsCopy <- thisYearsProjections
```

Beep beep liftoff
#Get each players projections through ridge regression
```{r}
y <- trainRF$actualPoints
x <- trainRF %>% select(-c(actualPoints)) %>% select(everything()) %>% data.matrix()
lambdas <- 10^seq(3, -2, by = -.1)

cv_fit <- cv.glmnet(x, y, alpha = 0, lambda = lambdas)
plot(cv_fit)
opt_lambda <- cv_fit$lambda.min
fit <- cv_fit$glmnet.fit
```

```{r}
xTest <- predictionData %>% select(everything()) %>% data.matrix()
y_predicted <- predict(fit, s = opt_lambda, newx = xTest)

thisYearsProjectionsCopy$predictions <- as.numeric(y_predicted)

thisYearsProjectionsCopy %>% arrange(-predictions)
```

Get each player's risk through random forests
#Run 10 RF's and average the sds for the upcoming season
takes 5 minutes
```{r}
#Make 10 random forests and average the predictions n SDs
i = 1
allPredictions <- c()
allSDs <- c()
for (i in 1:10) {
  rf <- randomForest(actualPoints ~., data = trainRF, na.action = na.exclude)
  predictions <- predict(rf, newdata = predictionData, type="response")
  intervals <- predict(rf, newdata = predictionData, predict.all = TRUE)
  
  pred.rf.int <- apply(intervals$individual, 1, function(x) {
    c(mean(x) + c(-1, 1) * sd(x), 
      quantile(x, c(0.025, 0.975)))
  })
  
  tableOfConfidence <- t(pred.rf.int)
  i = 1
  sdList <- ""
  for (i in 1:nrow(tableOfConfidence)) {
    lowBound <- tableOfConfidence[i,3]
    highBound <- tableOfConfidence[i,4]
    sd <- (highBound - lowBound) / 4
    sdList<- c(sdList, sd)
  }
  sdList <- sdList[-1]
  sdList <- as.numeric(sdList)
  
  
  allPredictions <- rbind(predictions, allPredictions)
  allSDs <- rbind(sdList, allSDs)

  
  if (i == 10) {
    break
  }
}

finalPreds <- colMeans(allPredictions)
finalSDs <- colMeans(allSDs)

thisYearsProjectionsCopy$sd <- finalSDs

View(thisYearsProjectionsCopy %>% arrange(-sd))

thisYearsProjectionsCopy
```



---CLEAN and LEARNING DONE---


##Exploration SZN

Adding necessary columns and cleaning for analysis
```{r}
pointsPlusADP <- espnProjections %>% 
  left_join(espnADP, by = "Name")

pointsPlusADP[pointsPlusADP$position.x %in% c('RB','TE','WR','QB'),] <- pointsPlusADP[pointsPlusADP$position.x %in% c('RB','TE','WR','QB'),] %>% 
  mutate(projectedPoints = rushYards*.1 + receivingYds*.1 + 6*rushTDs + 6*receivingTDs + receptions + passingYds*.04 + passTDs * 4 - Ints*2)

##ATTACH THE PROJECTIONS!!!
thisYearsProjectionsCopy %>% select(predictions)

pointsPlusADP <- pointsPlusADP %>% left_join(select(thisYearsProjectionsCopy, predictions, sd, Name), by = "Name")

pointsPlusADP$Team.x[is.na(pointsPlusADP$predictions)] <- str_sub(pointsPlusADP$Team.x[is.na(pointsPlusADP$predictions)], 1, -3)

pointsPlusADP$projectedPoints[!is.na(pointsPlusADP$predictions)] <- pointsPlusADP$predictions[!is.na(pointsPlusADP$predictions)]


pointsPlusADP <- pointsPlusADP %>% 
  arrange(position.x, -projectedPoints) %>% 
  group_by(position.x) %>% 
  mutate(positionRank = row_number())



replacementQB <- pointsPlusADP[pointsPlusADP$position.x == "QB" & pointsPlusADP$positionRank == numberOfTeams+1,]$projectedPoints
replacementRB <- pointsPlusADP[pointsPlusADP$position.x == "RB" & pointsPlusADP$positionRank == (numberOfTeams*2) + (numberOfTeams/2),]$projectedPoints
replacementWR <- pointsPlusADP[pointsPlusADP$position.x == "WR" & pointsPlusADP$positionRank == (numberOfTeams*2) + (numberOfTeams/2),]$projectedPoints
replacementTE <- pointsPlusADP[pointsPlusADP$position.x == "TE" & pointsPlusADP$positionRank == numberOfTeams+1,]$projectedPoints
replacementST <- pointsPlusADP[pointsPlusADP$position.x == "ST" & pointsPlusADP$positionRank ==  numberOfTeams / 2,]$projectedPoints

pointsPlusADP <- pointsPlusADP %>% 
  mutate(replacement = case_when(
    position.x == "QB" ~ replacementQB,
    position.x == "RB" ~ replacementRB,
    position.x == "TE" ~ replacementTE,
    position.x == "WR" ~ replacementWR,
    position.x == "ST" ~ replacementST
  ),
  PAR = projectedPoints - replacement)

#SD for positions
temp <- pointsPlusADP %>% 
  group_by(position.x) %>% 
  summarise(sd = sd(PAR)) 

pointsPlusADP <- pointsPlusADP %>% left_join(temp, by="position.x")
pointsPlusADP$sd.x[is.na(pointsPlusADP$predictions)] <- pointsPlusADP$sd.y[is.na(pointsPlusADP$predictions)]

pointsPlusADP$ADP[is.na(pointsPlusADP$ADP)] <- max(pointsPlusADP$ADP, na.rm = TRUE)

#SD for ADP
firstPickSD <- 1.5
lastPickSD <- 30
logExponent <- log(lastPickSD - firstPickSD+1) / (nrow(pointsPlusADP) - 1)
exponent <- exp(logExponent)
vector <- c()

pointsPlusADP <- pointsPlusADP %>%  arrange(Rank.x)
for (i in 1:nrow(pointsPlusADP)) {
  vector[i] <- .25*i + 1
}

pointsPlusADP$adpSD <- vector

pointsPlusADP <- pointsPlusADP %>% filter(position.x %in% c("RB", "WR", "TE", "QB", "ST"),
                                          !Name %in% c("Eric Ebron", "Andrew Luck", "Lamar Miller"))


```





```{r}
ggplot(pointsPlusADP, aes(x=ADP, y=projectedPoints, color = position.x)) +
  geom_point() +
  geom_text(label = pointsPlusADP$Name, size = 2)
```


```{r}
ggplot(pointsPlusADP, aes(x=ADP, y=PAR, color = position.x)) +
  geom_point() +
  geom_text(label = pointsPlusADP$Name, size = 2)  +
  ggtitle("Points Above Replacement (PAR) vs Average Draft Pick (ADP)")
```







Ceiling Creator...
```{r}
roundUp <- function(x,to=numberOfTeams)
{
  to*(x%/%to + as.logical(x%%to))
}
```


#Who's been drafted by everyone?
```{r}
draftedOverall <- c(
                    )




yourTeam <- c(
              )

```


#OPTIMIZER ALERT WEE WOO WEE WOO#

!Optimizer!
```{r}
#variable initialization
copy <- pointsPlusADP
rb <- 0 
wr <- 0 
te <- 0
qb <- 0 
st <- 0
other <- 0
availableRBs <- TRUE
availableWRs <- TRUE
availableFLEX <- TRUE & isFlex
availableTEs <- TRUE
availableQBs <- TRUE
availableSTs <- TRUE
PAR <- 0
valueOverStarter <- 0 
createdDataframe <- data.frame()
secondDataframe <- data.frame()



#creating the relative rank of the players drafted
yourDraft <- copy[copy$Name %in% yourTeam,]
yourDraft <- yourDraft %>% 
  group_by(position.x) %>% 
  arrange(position.x, -PAR) %>% 
  mutate(teamRank = row_number())


#Finding starter level on your team
secondRB <- yourDraft[yourDraft$teamRank == 2 & yourDraft$position.x == "RB",]
secondRB <- ifelse(nrow(secondRB) == 0, 0, secondRB$projectedPoints)
secondWR <- yourDraft[yourDraft$teamRank == 2 & yourDraft$position.x == "WR",]
secondWR <- ifelse(nrow(secondWR) == 0, 0, secondWR$projectedPoints)
thirdRB <- yourDraft[yourDraft$teamRank == 3 & yourDraft$position.x == "RB",]
thirdRB <- ifelse(nrow(thirdRB) == 0, 0, thirdRB$projectedPoints)
thirdWR <- yourDraft[yourDraft$teamRank == 3 & yourDraft$position.x == "WR",]
thirdWR <- ifelse(nrow(thirdWR) == 0, 0, thirdWR$projectedPoints)

worstFLEX <- ifelse(thirdRB > thirdWR, thirdRB - replacementRB, thirdWR - replacementWR)

worstStartingRB <- ifelse(isFlex, worstFLEX, secondRB - replacementRB)
worstStartingWR <- ifelse(isFlex, worstFLEX, secondWR - replacementWR)
worstQB <- yourDraft[yourDraft$position.x == "QB" & yourDraft$teamRank == 1,]$PAR
worstQB[length(worstQB) == 0] <- 0
worstTE <- yourDraft[yourDraft$position.x == "TE" & yourDraft$teamRank == 1,]$PAR
worstTE[length(worstTE) == 0] <- 0
worstST <- yourDraft[yourDraft$position.x == "ST" & yourDraft$teamRank == 1,]$PAR
worstST[length(worstST) == 0] <- 0


#get available players
available <- copy[!copy$Name %in% draftedOverall,] %>% arrange(-PAR)


#find how many of each position you have
for (i in yourTeam) {
  row <- copy %>% filter(Name == i)
  position <- row$position.x
  rb[position == "RB"] <- rb + 1
  wr[position == "WR"] <- wr + 1
  te[position == "TE"] <- te + 1
  qb[position == "QB"] <- qb + 1
  st[position == "ST"] <- st + 1
  
  availableRBs[rb >= 2] <- FALSE
  availableWRs[wr >= 2] <- FALSE
  availableFLEX[wr >= 3 | rb >= 3] <- FALSE & isFlex
  availableTEs[te >= 1] <- FALSE
  availableQBs[qb >= 1] <- FALSE
  availableSTs[st >= 1] <- FALSE
}

#BENCH / STARTER OPTIMIZATION SZN

#Relative value for a bench player compared to starter
j = 29
for (j in 1:nrow(available)) {
  player <- available[j,]
  
  position <- player$position.x
  
  
  startingRB <- (availableRBs | availableFLEX)
  startingWR <- (availableWRs | availableFLEX)
  
  avgChanceOfStartingRB <- (1-pnorm(worstStartingRB, player$PAR, player$sd.x)) / 2
  avgChanceOfStartingWR <- (1-pnorm(worstStartingWR, player$PAR, player$sd.x)) / 2
  avgChanceOfStartingTE <- (1-pnorm(worstTE, player$PAR, player$sd.x)) / 2
  avgChanceOfStartingQB <- (1-pnorm(worstQB, player$PAR, player$sd.x)) / 2
  avgChanceOfStartingST <- (1-pnorm(worstST, player$PAR, player$sd.x)) / 2
  
  startingValueRB <- qnorm(1-avgChanceOfStartingRB, player$PAR, player$sd.x) * avgChanceOfStartingRB
  startingValueWR <- qnorm(1-avgChanceOfStartingWR, player$PAR, player$sd.x) * avgChanceOfStartingWR
  startingValueTE <- qnorm(1-avgChanceOfStartingTE, player$PAR, player$sd.x) * avgChanceOfStartingTE
  startingValueQB <- qnorm(1-avgChanceOfStartingQB, player$PAR, player$sd.x) * avgChanceOfStartingQB
  startingValueST <- qnorm(1-avgChanceOfStartingST, player$PAR, player$sd.x) * avgChanceOfStartingST
  
  valueOverStarter[position=="RB"] <- ifelse(startingRB, player$PAR, startingValueRB)
  valueOverStarter[position == "WR"] <- ifelse(startingWR, player$PAR, startingValueWR)
  valueOverStarter[position=="TE"] <- ifelse(availableTEs, player$PAR, startingValueTE) 
  valueOverStarter[position=="QB"] <- ifelse(availableQBs, player$PAR, startingValueQB)
  valueOverStarter[position=="ST"] <- ifelse(availableSTs, player$PAR, startingValueST)
  
  #Finding pick number, your next pick, and the likelihood of a player staying on board
  pickNumber <- length(draftedOverall) + 1
  ceiling <- roundUp(pickNumber)
  leftTillEndOfRound <- ceiling - pickNumber
  nextPick <- ceiling + leftTillEndOfRound + 1
  
  chanceOfStayingOnBoard <- 1 - pnorm(nextPick, player$ADP, player$adpSD)
  
  #round after likelihood
  ceiling <- roundUp(nextPick)
  leftTillEndOfRound <- ceiling - nextPick
  pickAfter <- ceiling + leftTillEndOfRound + 1
  
  chanceOfStayingOnBoardTwoRounds <- 1 - pnorm(pickAfter, player$ADP, player$adpSD)
  
  #round after...
  ceiling <- roundUp(pickAfter)
  leftTillEndOfRound <- ceiling - pickAfter
  pickEvenAfter <- ceiling + leftTillEndOfRound + 1
  
  chanceOfStayingOnThreeRounds <- 1 - pnorm(pickEvenAfter, player$ADP, player$adpSD)
  
  
  CreatedRow <- data.frame(player$Name,position, player$PAR, valueOverStarter, chanceOfStayingOnBoard, chanceOfStayingOnBoardTwoRounds, chanceOfStayingOnThreeRounds)
  createdDataframe <- rbind(createdDataframe, CreatedRow)
}

createdDataframe <- createdDataframe %>% 
  rename(Name = player.Name,
         PAR = player.PAR) %>% 
  arrange(-PAR)

#find the chance of all players of the same position sticking around to next round
i = 1
for (i in 1:nrow(createdDataframe)) {
  newRow <- createdDataframe[i,]
  playerPosition <- as.character(newRow$position)
  
  positionallyFiltered <- createdDataframe %>% 
    filter(position == playerPosition) %>% 
    dplyr::slice(1:12)
  
  
  positionallyFiltered$chanceOfBeingBestOption <- 0
  positionallyFiltered$chanceOfBeingBestOptionTwoRounds <- 0
  positionallyFiltered$chanceOfBeingBestOptionThreeRounds <- 0
  
  j = 1
  #find the chance that each player for each position is going to be the best player available come next pick
  for (j in 1:nrow(positionallyFiltered)) {
    row <- positionallyFiltered[j,]
    
    #next round chance of being the best available
    prevRow <- positionallyFiltered[j-1,]
    row$chanceOfBeingBestOption[j == 1] <- row$chanceOfStayingOnBoard
    row$chanceOfBeingBestOption[nrow(prevRow) != 0 & prevRow$chanceOfStayingOnBoard == 0] <- row$chanceOfStayingOnBoard
    row$chanceOfBeingBestOption[j>1 & prevRow$chanceOfStayingOnBoard > 0] <-  row$chanceOfStayingOnBoard * (prevRow$chanceOfBeingBestOption / prevRow$chanceOfStayingOnBoard) * (1-prevRow$chanceOfStayingOnBoard)
    
    #round after
    row$chanceOfBeingBestOptionTwoRounds[j == 1] <- row$chanceOfStayingOnBoardTwoRounds
    row$chanceOfBeingBestOptionTwoRounds[nrow(prevRow) != 0 & prevRow$chanceOfStayingOnBoardTwoRounds == 0] <- row$chanceOfStayingOnBoardTwoRounds
    row$chanceOfBeingBestOptionTwoRounds[j>1 & prevRow$chanceOfStayingOnBoardTwoRounds > 0] <-  row$chanceOfStayingOnBoardTwoRounds * (prevRow$chanceOfBeingBestOptionTwoRounds / prevRow$chanceOfStayingOnBoardTwoRounds) * (1-prevRow$chanceOfStayingOnBoardTwoRounds)
    
    #round after that
    row$chanceOfBeingBestOptionTwoRounds[j == 1] <- row$chanceOfStayingOnBoardTwoRounds
    row$chanceOfBeingBestOptionTwoRounds[nrow(prevRow) != 0 & prevRow$chanceOfStayingOnBoardTwoRounds == 0] <- row$chanceOfStayingOnBoardTwoRounds
    row$chanceOfBeingBestOptionTwoRounds[j>1 & prevRow$chanceOfStayingOnBoardTwoRounds > 0] <-  row$chanceOfStayingOnBoardTwoRounds * (prevRow$chanceOfBeingBestOptionTwoRounds / prevRow$chanceOfStayingOnBoardTwoRounds) * (1-prevRow$chanceOfStayingOnBoardTwoRounds)
    
    positionallyFiltered[j,] <- row
    
    prevRow$chanceOfStayingOnBoardTwoRounds > 0 & j>1
  }
  
  
  #calculating the average positional values for ensuing rounds
  nextRoundValue <- sum(positionallyFiltered$chanceOfBeingBestOption * positionallyFiltered$valueOverStarter) 
  nextRoundValue[is.infinite(nextRoundValue) | is.nan(nextRoundValue)] <- 1000
  newRow$valueOverNextRound <- newRow$valueOverStarter - nextRoundValue
  
  valueOverTwoRounds <- sum(positionallyFiltered$chanceOfBeingBestOptionTwoRounds * positionallyFiltered$valueOverStarter) 
  valueOverTwoRounds[is.infinite(valueOverTwoRounds) | is.nan(valueOverTwoRounds)] <- 1000
  newRow$valueOverTwoRounds <- newRow$valueOverStarter - valueOverTwoRounds
  
  valueOverThreeRounds <- sum(positionallyFiltered$chanceOfBeingBestOptionTwoRounds * positionallyFiltered$valueOverStarter) 
  valueOverThreeRounds[is.infinite(valueOverThreeRounds) | is.nan(valueOverThreeRounds)] <- 1000
  newRow$valueOverThreeRounds <- newRow$valueOverStarter - valueOverThreeRounds
  
  secondDataframe <- rbind(secondDataframe, newRow)
} 


#show me the money
View(secondDataframe %>% 
       select(Name, position, PAR, valueOverStarter, chanceOfStayingOnBoard, valueOverNextRound, valueOverThreeRounds) %>% 
       arrange(-valueOverNextRound))

```



```{r}
View(secondDataframe)
```

```{r}
ggplot(pointsPlusADP, aes(x=ADP, y=PAR, color = position.x)) +
  geom_point() +
  geom_text(label = pointsPlusADP$Name, size = 2)  +
  ggtitle("Points Above Replacement (PAR) vs Average Draft Pick (ADP)") 
```

sleepers / value picks
```{r}
rbs <- pointsPlusADP %>% filter(position.x == "RB")
ggplot(rbs, aes(x=ADP, y=PAR)) +
  geom_point() +
  geom_text(label = rbs$Name, size = 2)  +
  geom_smooth() +
  ggtitle("Points Above Replacement (PAR) vs Average Draft Pick (ADP)") 

wrs <- pointsPlusADP %>% filter(position.x == "WR")
ggplot(wrs, aes(x=ADP, y=PAR)) +
  geom_point() +
  geom_text(label = wrs$Name, size = 2)  +
  geom_smooth() +
  ggtitle("Points Above Replacement (PAR) vs Average Draft Pick (ADP)") 


TEs <- pointsPlusADP %>% filter(position.x == "TE")
ggplot(TEs, aes(x=ADP, y=PAR)) +
  geom_point() +
  geom_text(label = TEs$Name, size = 2)  +
  geom_smooth() +
  ggtitle("Points Above Replacement (PAR) vs Average Draft Pick (ADP)") 

QBs <- pointsPlusADP %>% filter(position.x == "QB")
ggplot(QBs, aes(x=ADP, y=PAR)) +
  geom_point() +
  geom_text(label = QBs$Name, size = 2)  +
  geom_smooth() +
  ggtitle("Points Above Replacement (PAR) vs Average Draft Pick (ADP)") 
```






```{r}
simplifiedRanks <- pointsPlusADP %>% 
  select(Name, position.x, projectedPoints, ADP,PAR) %>% 
  arrange(-PAR)

write.csv(simplifiedRanks, file = "new ranks.csv")
```



